"use strict";(self.webpackChunkfused_docs=self.webpackChunkfused_docs||[]).push([[2422],{4564:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>f,toc:()=>c});var r=e(4848),s=e(8453),a=e(3650);const o={},i="Raster with H3",f={id:"basics/transform/h3/raster-to-h3",title:"Raster with H3",description:"",source:"@site/docs/basics/transform/h3/raster-to-h3.mdx",sourceDirName:"basics/transform/h3",slug:"/basics/transform/h3/raster-to-h3",permalink:"/fused-docs/basics/transform/h3/raster-to-h3",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\ud83d\udee0\ufe0f H3 to vector",permalink:"/fused-docs/basics/transform/h3/h3-to-vector"},next:{title:"Vector to H3",permalink:"/fused-docs/basics/transform/h3/vector-to-h3"}},d={},c=[];function h(t){const n={code:"code",h1:"h1",pre:"pre",...(0,s.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"raster-with-h3",children:"Raster with H3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@fused.udf\ndef udf(\n    tiff_path: str = "s3://fused-asset/gfc2020/JRC_GFC2020_V1_N60_E20.tif",\n    chunk_id: int = 0,\n    x_chunks: int = 1,\n    y_chunks: int = 1,\n    coarsen: int = 100,\n    h3_size=6,\n):\n    import geopandas as gpd\n    import pandas as pd\n    from shapely.geometry import box\n    from utils import chunked_tiff_to_points, run_query\n\n    df_tiff = chunked_tiff_to_points(\n        tiff_path, i=chunk_id, x_chunks=x_chunks, y_chunks=y_chunks, coarsen=coarsen\n    )\n\n    qr = f"""\n        SELECT h3_latlng_to_cell(lat, lng, {h3_size}) AS hex, ARRAY_AGG(data) as agg_data\n        FROM df_tiff\n        group by 1\n      --  order by 1\n\n    """\n\n    df = run_query(qr, return_arrow=True)\n    df = df.to_pandas()\n    df["agg_data"] = df.agg_data.map(lambda x: pd.Series(x).sum())\n    df["hex"] = df["hex"].map(lambda x: hex(x)[2:])\n    df["metric"] = df.agg_data / df.agg_data.max() * 100\n    print(df)\n    # Use this return statement to locate the output on the map\n    # return gpd.GeoDataFrame(geometry=[box(df_tiff.lng.min(), df_tiff.lat.min(), df_tiff.lng.max(), df_tiff.lat.max())])\n    return df\n\n'})}),"\n","\n","\n",(0,r.jsx)(a.A,{url:"https://staging.fused.io/workbench#app/s/aH4sIAAAAAAAAA6VWbWvjOBD%2BK8L9kPhwG7%2FEbRow3LK7ve5x9KApexxxMIolO6KK5JPkttnS%2F34j2c1L2cuHizFYM6NnHs1oNPKrV0pCvanH1o1UBjUbQstHhDVqyGMueq02iuI1Z8YatNnqq1ZTUuCm2WpqKhssCEyDt25ILnKhzYVhhtNh7t1jbahCRqLbJPd8a%2F00m319mKEMveYCwZN7v99%2FLn67%2BRyHcVh8j4rZOCy%2BpiH4qHJvil4HreKDKRroZDoauRWcY62pGdVVaTGjD%2Fi7S8DHDj8I0IBjw0UNDuZpGqA4XbwFx4gv%2Fz%2FxHv6Q%2BHwMzJdHmO8sMkpOiHnPwSF3AtRRcizq%2BETufQcf4o7T4Cj3nYVenRD2Dn%2FIHEHUV8eIIwCOTyDe4T%2FUWIDGx3hTwJ1Au4Ufstr6OsaahMVfUXQC756DQ2bYYXQehUCeizd7vHPhPMH5hjagKaelWcoXaAUzN0YPrKqQm5J7AeqawcUj3eih7%2FfYomy1kevOhaEvpmCiaQ34%2BFOhBqagjWwVks8CPXy7uUHFsOQUQ5dZMY2AzLYbRU2rBKok%2BLIyUbIhgPALS3snBfVdo3pWzNhG9bf16Lw12KwQ03ba%2Fmpg%2BiopNPtB%2FzO02wRZu0UqLGo6HAcT3%2B874h4R6rCUTHcpmDuuxdztzKIDAfd7Lg%2FyItVPQRbzKzCVuFzRgmCDc0FohbjExIlDNz1AfRxZ6k%2B7giEVUGx7%2B4VqxXBAkglsfhKWUXodhTS6JtEkLCcTki7HJUnDeBJRqAg8jifjS7rEMRiukrJaXtLrZEmWUCZQLFXh0tkHsKPuv37H328WqWwIbjG7NW%2Bz8DMw1GGAoBIB8SEjfYW6pJyhL7RigiKMON501xFhugEBSQHaNW6sL2vK7D148YcdD99P021yS19wLYVTw569Z60fNKx8xEtOswfV0l4HN6h8pGRfVTHODzVQ2qoloLvBXL8rawh41fFluQejLaG1WCdFKblUYITTl6JztKZGsfKXKLTXG5zHrbyw9XXWiTsXHFLRu5jHYwcKULjoSZz1mRGzKtZMFA17oVxnMVj97nifoXsKdaVcVXe%2FD0W5wsr0%2BbL5%2BwLKXrQP5LfQZgMZyj0Yw6GBtuMUetTJI40N5fDDQc%2BfrrcB24cJZhjmxROjz%2BAEpmWW4TuIMysNYaeZgSxmXTFIUfeiqAP0Q8p1Ng7QEvoDE3UG0TbMlKss9Pc43NbrbO6%2Biz2DkZIb1mSvuWf7kO2dufeprtET5i2FRorr2pXpW%2B69dTB%2Fm6hceIGn6D8tU3RNhdHedO5t%2F5d6G9XGDl%2BwUngDgw1WHD5dXr1F4DF903I%2BKxWlwptWtlDe%2FgWPhWeExQkAAA%3D%3D"})]})}function u(t={}){const{wrapper:n}={...(0,s.R)(),...t.components};return n?(0,r.jsx)(n,{...t,children:(0,r.jsx)(h,{...t})}):h(t)}},3650:(t,n,e)=>{e.d(n,{A:()=>s});e(6540);var r=e(4848);function s(t){let{children:n,url:e}=t;return(0,r.jsx)("iframe",{src:e,height:"1050px",width:"100%",scrolling:"no"})}},8453:(t,n,e)=>{e.d(n,{R:()=>o,x:()=>i});var r=e(6540);const s={},a=r.createContext(s);function o(t){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function i(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:o(t.components),r.createElement(a.Provider,{value:n},t.children)}}}]);