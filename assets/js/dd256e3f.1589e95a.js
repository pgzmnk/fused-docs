"use strict";(self.webpackChunkfused_docs=self.webpackChunkfused_docs||[]).push([[1860],{4178:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var s=t(4848),a=t(8453);const i={id:"overview",title:"Overview",tags:["Overview","Hosted API"],sidebar_position:0},o="Hosted API overview",r={id:"hosted-api/overview",title:"Overview",description:"UDFs saved on Fused cloud can be called as HTTP endpoints.",source:"@site/docs/hosted-api/overview.md",sourceDirName:"hosted-api",slug:"/hosted-api/overview",permalink:"/fused-docs/hosted-api/overview",draft:!1,unlisted:!1,tags:[{label:"Overview",permalink:"/fused-docs/tags/overview"},{label:"Hosted API",permalink:"/fused-docs/tags/hosted-api"}],version:"current",sidebarPosition:0,frontMatter:{id:"overview",title:"Overview",tags:["Overview","Hosted API"],sidebar_position:0}},d={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Get an account&#39;s private token",id:"get-an-accounts-private-token",level:2},{value:"Create and manage shared tokens (recommended)",id:"create-and-manage-shared-tokens-recommended",level:2},{value:"Manage shared tokens",id:"manage-shared-tokens",level:3},{value:"Single File HTTP endpoints",id:"single-file-http-endpoints",level:3},{value:"Tile HTTP endpoints",id:"tile-http-endpoints",level:3},{value:"Call UDF endpoints",id:"call-udf-endpoints",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"hosted-api-overview",children:"Hosted API overview"}),"\n",(0,s.jsx)(n.p,{children:"UDFs saved on Fused cloud can be called as HTTP endpoints."}),"\n",(0,s.jsx)(n.p,{children:'This section shows how to generate and make authenticated calls to these endpoints, and the "integrations" section shows examples of how to use them to integrate with your team\'s most important tools.'}),"\n",(0,s.jsx)(n.p,{children:"Using the Fused Hosted API supercharges your stack with the ability to trigger and load the output of any scale workflows. API calls automatically provision serverless compute resources to run workflows in parallel using advanced caching and geo partitioning - without your team needing to spend time on setup."}),"\n",(0,s.jsx)(n.p,{children:"Endpoints created with Fused Hosted API seamlessly integrate with tools such as:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Tile-based maps: Simply pass the endpoint into tile-based maps such as open source JavaScript tools (e.g. leaflet, Deck.gl, and Kepler.gl), proprietary web-based apps (such as Felt and Foursquare Studio), or desktop based tools such as ArcGIS, ESRI, and QGIS."}),"\n",(0,s.jsx)(n.li,{children:"Apps that make HTTP requests: Load data into low-code app builders such as Streamlit & Retool."}),"\n",(0,s.jsx)(n.li,{children:"Apps that render embeddable maps: Embed responsive maps to significantly enhance the utility and interactivity of documentation sites and apps, such as Notion."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Read on to learn how."}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"This section describes how to create a UDF endpoint either in Workbench or with the Fused Python SDK, and how to authenticate requests to call the endpoint."}),"\n",(0,s.jsx)(n.p,{children:'Endpoints can be called with "private" or "shared" authentication tokens. They are created as follows:'}),"\n",(0,s.jsx)(n.h2,{id:"get-an-accounts-private-token",children:"Get an account's private token"}),"\n",(0,s.jsxs)(n.p,{children:["Python environments where the authentication flow completed successfully store a credentials key in the default location ",(0,s.jsx)(n.code,{children:" ~/.fused/credentials"}),". Calls to UDFs from those environments will use that key, unless a token for a different account is explicitly set in the call. Making calls to endpoints from a non-authenticated environment will need the authenticated account's access token, which can be retrieved with the following commands."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from fused._auth import CREDENTIALS\n\nCREDENTIALS.credentials.access_token\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"danger",children:[(0,s.jsx)(n.p,{children:'Note that the "private" token can access all UDFs and should be kept private. The recommended approach is instead to use "shared" tokens with tightly scoped permissions, as detailed below.'}),(0,s.jsx)(n.p,{children:"Remember that tokens are tied to the account that created them and requests to their corresponding endpoints will accrue charges on that account."})]}),"\n",(0,s.jsx)(n.p,{children:"This is how to call UDF endpoints via HTTP requests with the token."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl -XGET https://app.fused.io/server/v1/realtime-shared/$SHARED_TOKEN/run/file\n"})}),"\n",(0,s.jsx)(n.h2,{id:"create-and-manage-shared-tokens-recommended",children:"Create and manage shared tokens (recommended)"}),"\n",(0,s.jsx)(n.p,{children:"Shared tokens are tightly scoped to a single UDF, and can easily be revoked. Creating a shared token for a UDF returns a token object that, among other attributes, contains the token as a string and sample endpoint URLs."}),"\n",(0,s.jsx)(n.p,{children:"This is how to to call UDF endpoints in Python with signed token URLs."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from fused.api import FusedAPI\napi = FusedAPI()\n\ntoken_object = api.create_udf_access_token(udf_email="user@fused.io", udf_name="caltrain_live_location")\noutput = fused.core.run_shared_file(token=token_object.token, my_param="...")\n'})}),"\n",(0,s.jsx)(n.h3,{id:"manage-shared-tokens",children:"Manage shared tokens"}),"\n",(0,s.jsx)(n.p,{children:"Fetch a specific UDF token object using its unique token string:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"token_object = api.get_udf_access_token(token=token.token)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Fetch all UDF tokens:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"token_objects = api.get_udf_access_tokens()\n"})}),"\n",(0,s.jsx)(n.p,{children:"Update a specific UDF token using its unique token string:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"token_object = api.update_udf_access_token(token=token.token, enabled=True)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Delete a specific UDF token using its unique token string:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"api.delete_udf_access_token(token=token.token, enabled=True)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Similarly, signed URLs endpoints can be created that can be called from another application via HTTP requests."}),"\n",(0,s.jsx)(n.h3,{id:"single-file-http-endpoints",children:"Single File HTTP endpoints"}),"\n",(0,s.jsxs)(n.p,{children:["Single file HTTP endpoints are suitable for handling individual requests, ideal for scenarios where a single resource is required, such as loading data into ",(0,s.jsx)(n.a,{href:"/basics/out/googlesheets/",children:"Google Sheets"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from fused.api import FusedAPI\napi = FusedAPI()\n\n# URL for single call\napi.create_udf_access_token(udf_email="user@fused.io", udf_name="caltrain_live_location").get_file_url()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"tile-http-endpoints",children:"Tile HTTP endpoints"}),"\n",(0,s.jsxs)(n.p,{children:["Tile HTTP endpoints are designed for serving map applications that consume Tiles, such as ",(0,s.jsx)(n.a,{href:"/basics/out/lonboard/",children:"Lonboard"})," or ",(0,s.jsx)(n.a,{href:"/basics/out/geemap/",children:"geemap"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from fused.api import FusedAPI\napi = FusedAPI()\n\n# URL for XYZ tiles\napi.create_udf_access_token(udf_email="user@fused.io", udf_name="caltrain_live_location").get_tile_url()\n'})}),"\n",(0,s.jsx)(n.h2,{id:"call-udf-endpoints",children:"Call UDF endpoints"}),"\n",(0,s.jsx)(n.p,{children:"The Fused Python SDK exposes methods to call UDFs. In Python environments authenticated to Fused, the UDF be called or imported in these 3 ways:"}),"\n",(0,s.jsx)(n.p,{children:"Call UDF and return its output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'output = fused.core.run_file("user@fused.io", "caltrain_live_location")\n'})}),"\n",(0,s.jsx)(n.p,{children:"Call UDF asynchronously and return its output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'output = await fused.core.run_file_async("user@fused.io", "caltrain_live_location")\n'})}),"\n",(0,s.jsx)(n.p,{children:"Import as a UDF object:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'my_udf = fused.core.load_udf_from_fused("user@fused.io", "caltrain_live_location")\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Did you know UDFs can also call other UDFs? It's an easy way to chain UDFs together or even run jobs in parallel."})}),"\n",(0,s.jsx)(n.p,{children:"Other environments can call the UDF endpoint via HTTP requests and receive its output in the response body."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -XGET "https://app.fused.io/server/v1/realtime/fused/api/v1/run/udf/saved/user@fused.io/caltrain_live_location?dtype_out_raster=png&dtype_out_vector=parquet" -H "Authorization: Bearer $ACCESS_TOKEN"\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)(n.p,{children:'Once you save a UDF in workbench, the "Settings" tab of the editor will show the above as snippets you can easily copy to use the UDF from different environments.'}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://fused-magic.s3.us-west-2.amazonaws.com/docs_assets/snippets_caltrain.png",alt:"alt text"})})]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var s=t(6540);const a={},i=s.createContext(a);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);