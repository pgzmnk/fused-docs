"use strict";(self.webpackChunkfused_docs=self.webpackChunkfused_docs||[]).push([[9548],{1368:(t,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>o,default:()=>x,frontMatter:()=>r,metadata:()=>d,toc:()=>c});var l=s(4848),n=s(8453),i=s(8987);s(1023),s(290);const r={title:"Zonal Stats",sidebar_label:"Zonal Stats",path:"basics/transform/zonalstats/zonalstats",nb_path:"basics/transform/zonalstats.ipynb",github:"https://github.com/fusedio/fused-docs/blob/main/docs/basics/transform/zonalstats.ipynb",colab:"https://githubtocolab.com/fusedio//fused-docs/blob/main/docs/basics/transform/zonalstats.ipynb"},o="Zonal Stats",d={id:"basics/_transform/zonalstats/Zonalstats",title:"Zonal Stats",description:"<LinkButtons",source:"@site/docs/basics/_transform/zonalstats/Zonalstats.mdx",sourceDirName:"basics/_transform/zonalstats",slug:"/basics/_transform/zonalstats/",permalink:"/fused-docs/basics/_transform/zonalstats/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Zonal Stats",sidebar_label:"Zonal Stats",path:"basics/transform/zonalstats/zonalstats",nb_path:"basics/transform/zonalstats.ipynb",github:"https://github.com/fusedio/fused-docs/blob/main/docs/basics/transform/zonalstats.ipynb",colab:"https://githubtocolab.com/fusedio//fused-docs/blob/main/docs/basics/transform/zonalstats.ipynb"}},a={},c=[];function f(t){const e={code:"code",h1:"h1",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...t.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.A,{githubUrl:"https://github.com/fusedio/fused-docs/blob/main/docs/basics/transform/zonalstats.ipynb",colabUrl:"https://githubtocolab.com/fusedio//fused-docs/blob/main/docs/basics/transform/zonalstats.ipynb"}),"\n",(0,l.jsx)(e.h1,{id:"zonal-stats",children:"Zonal Stats"}),"\n",(0,l.jsx)(e.p,{children:"This UDF shows how to extract zonal statistics from a raster for areas that correspond\nto a set of vector boundaries."}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-python",children:"# !pip install fused -q\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-python",children:'import fused\n\n\n@fused.udf\ndef udf(\n    bbox: fused.types.TileGDF, min_zoom=15, table="s3://fused-asset/infra/building_msft_us/", chip_len=256\n):\n\n    # Load utility functions\n    table_to_tile = fused.load(\n        "https://github.com/fusedio/udfs/tree/f928ee1/public/common/"\n    ).utils.table_to_tile\n    geom_stats = fused.load(\n        "https://github.com/fusedio/udfs/tree/f928ee1/public/common/"\n    ).utils.geom_stats\n    dsm_to_tile = fused.load(\n        "https://github.com/fusedio/udfs/tree/f928ee1/public/DSM_JAXA_Example"\n    ).utils.dsm_to_tile\n\n    # Conditionally run the UDF if zoom level is high enough, to avoid blowing up the memory\n    if bbox.z[0] >= min_zoom:\n\n        # Load GeoDataFrame (Vector)\n        gdf = table_to_tile(bbox, table, min_zoom)\n\n        # Load DSM array (Raster)\n        arr = dsm_to_tile(bbox, z_levels=[4, 6, 9, 11], verbose=False)\n\n        # Run zonal statistics\n        gdf_zonal = geom_stats(gdf, arr, chip_len=chip_len)\n        return gdf_zonal\n    else:\n        print("Please zoom more... (US Only)")\n\n\narr = fused.run(udf=udf, x=5239, y=12664, z=15, engine="realtime")\narr\n'})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{style:{textAlign:"left"}}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"geometry"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"stats"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"count"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"fused_index"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"787"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.43259 37.78323, -122.43246 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"42.666667"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"105"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"0"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"790"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.43368 37.78044, -122.43358 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"39.104046"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"173"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"1"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"816"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.43817 37.78252, -122.43814 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"47.529412"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"34"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"2"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"824"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.43981 37.78232, -122.43979 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"45.666667"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"54"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"3"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"1584"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.43277 37.78417, -122.43266 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"37.753695"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"203"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"4"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"..."})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"42219"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.43795 37.78136, -122.43796 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"52.000000"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"9"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"491"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"42222"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.43833 37.78663, -122.43832 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"47.000000"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"4"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"492"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"42223"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.43843 37.78440, -122.43841 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"54.000000"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"14"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"493"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"42230"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.44004 37.78030, -122.44012 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"58.000000"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"6"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"494"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"42234"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"POLYGON ((-122.44074 37.78012, -122.44074 37.7..."}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"66.000000"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"3"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"495"})]})]})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-python"})})]})}function x(t={}){const{wrapper:e}={...(0,n.R)(),...t.components};return e?(0,l.jsx)(e,{...t,children:(0,l.jsx)(f,{...t})}):f(t)}},1023:(t,e,s)=>{s.d(e,{A:()=>h});s(6540);var l,n=new Uint8Array(16);function i(){if(!l&&!(l="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return l(n)}const r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const o=function(t){return"string"==typeof t&&r.test(t)};for(var d=[],a=0;a<256;++a)d.push((a+256).toString(16).substr(1));const c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(d[t[e+0]]+d[t[e+1]]+d[t[e+2]]+d[t[e+3]]+"-"+d[t[e+4]]+d[t[e+5]]+"-"+d[t[e+6]]+d[t[e+7]]+"-"+d[t[e+8]]+d[t[e+9]]+"-"+d[t[e+10]]+d[t[e+11]]+d[t[e+12]]+d[t[e+13]]+d[t[e+14]]+d[t[e+15]]).toLowerCase();if(!o(s))throw TypeError("Stringified UUID is invalid");return s};const f=function(t,e,s){var l=(t=t||{}).random||(t.rng||i)();if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,e){s=s||0;for(var n=0;n<16;++n)e[s+n]=l[n];return e}return c(l)};var x=s(4848);const h=t=>(0,x.jsxs)("div",{style:{backgroundColor:"var(--ifm-background-surface-color)",marginBottom:"var(--ifm-leading)",borderRadius:"var(--ifm-global-radius)",boxShadow:"var(--ifm-global-shadow-lw)",overflow:"hidden",padding:"10px",font:"var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"},children:[(0,x.jsx)("span",{style:{color:"var(--ifm-color-primary)"},children:"Out: "}),(0,x.jsx)("pre",{style:{margin:"0px",backgroundColor:"inherit"},children:t.children.split("\n").map((t=>(0,x.jsx)("p",{style:{marginBottom:"0px"},children:t},f())))})]})},8987:(t,e,s)=>{s.d(e,{A:()=>i});s(6540);var l=s(8774),n=s(4848);const i=t=>{let{githubUrl:e,colabUrl:s}=t;return(0,n.jsxs)("div",{className:"link-buttons",style:{textAlign:"right"},children:[(0,n.jsx)("br",{}),(0,n.jsx)(l.A,{to:s,children:(0,n.jsx)("img",{src:"https://colab.research.google.com/assets/colab-badge.svg",alt:"Open in Colab"})})," ",(0,n.jsx)(l.A,{to:e,children:(0,n.jsx)("img",{src:"https://badgen.net/static/GitHub/Open/blue?icon=github",alt:"Open in GitHub"})})]})}},290:(t,e,s)=>{s(6540);var l=s(3259),n=s.n(l),i=(s(2303),s(4848));n()({loader:()=>s.e(1236).then(s.bind(s,1236)),loading:t=>{let{timedOut:e}=t;return e?(0,i.jsx)("blockquote",{children:"Error: Loading Plotly timed out."}):(0,i.jsx)("div",{children:"loading..."})},timeout:1e4})},8453:(t,e,s)=>{s.d(e,{R:()=>r,x:()=>o});var l=s(6540);const n={},i=l.createContext(n);function r(t){const e=l.useContext(i);return l.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function o(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(n):t.components||n:r(t.components),l.createElement(i.Provider,{value:e},t.children)}}}]);