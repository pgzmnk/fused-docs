"use strict";(self.webpackChunkfused_docs=self.webpackChunkfused_docs||[]).push([[3437],{8020:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>d,toc:()=>c});var o=e(4848),i=e(8453),s=e(3650);const a={},r="Point with polygon",d={id:"basics/transform/join/point-with-polygon",title:"Point with polygon",description:"",source:"@site/docs/basics/transform/join/point-with-polygon.mdx",sourceDirName:"basics/transform/join",slug:"/basics/transform/join/point-with-polygon",permalink:"/fused-docs/basics/transform/join/point-with-polygon",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Transform data",permalink:"/fused-docs/basics/transform"},next:{title:"Raster with polygon (Zonal stats)",permalink:"/fused-docs/basics/transform/join/raster-with-polygon"}},l={},c=[];function p(t){const n={code:"code",h1:"h1",pre:"pre",...(0,i.R)(),...t.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"point-with-polygon",children:"Point with polygon"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"@fused.udf\ndef udf(year: str = '2010', month: str = '01', n_rows: int = 10000, object_to_show='points'):\n    import geopandas as gpd\n    import h3\n    import pandas as pd\n\n    from utils import generate_color_from_identifier, lonlat_to_geom\n    \n    @fused.cache\n    def load_taxi_data(year, month, n_rows=n_rows):\n        return pd.read_parquet(f'https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_{year}-{month}.parquet').head(n_rows)\n\n    @fused.cache\n    def load_census_blocks(counties=[\"061\"]):\n        url=\"https://www2.census.gov/geo/tiger/TIGER_RD18/STATE/36_NEW_YORK/36/tl_rd22_36_bg.zip\"\n        gdf = gpd.read_file(url)\n        gdf = gdf[gdf[\"COUNTYFP\"].isin(counties)]\n        return gdf\n\n    # Load data\n    gdf_census_blocks = load_census_blocks()\n    taxi_data = load_taxi_data(year='2010', month='01')\n    taxi_data['geometry'] = lonlat_to_geom(taxi_data, cols_lonlat=['pickup_longitude','pickup_latitude'])\n    taxi_data = gpd.GeoDataFrame(taxi_data)\n\n    # Spatial join between points and polygons\n    joined = gpd.sjoin(taxi_data, gdf_census_blocks, how=\"left\", op=\"within\")\n    joined[['r', 'g', 'b']] = pd.DataFrame(joined['GEOID'].apply(generate_color_from_identifier).tolist(), index=joined.index)\n    return joined\n"})}),"\n","\n","\n",(0,o.jsx)(s.A,{url:"https://staging.fused.io/workbench#app/s/aH4sIAAAAAAAAA61U247aMBD9Fct9AKQsJOESQMpTq1aq%2BrDSVn0hKHLiSXAxdmqbZWm1%2F94xsCwbthepndxmzsyczIyd%2FKCl5kDnVGwabRxp9hzKNWGWNHydqRNqnQG2kcJ5h3VnvNpa4DlrmjNSg26Y4hiGZ93wTPnDur4TTkI3o7daKEeEIrda7mutMto7xmTK6TUokpJOkfBoVvJZEg%2BrOOKTURHFPK6mJY%2FYpAqHrOBJEUI8ScoiiYCzeJpwNmFxNC1ZBEUnU7xConN5fbNV3QN9QHTxFUqXO53bld6lneZYh%2B0EROVG72w6DlF6niNvfLX276l89DWRVHVAJHPI071Jhv3ZNElm44CMwn4yHo1no8MI3pC3OGUHZMOaw8iOa5GXK2ZcN1MEBRel%2Fw7Bk%2BkFo3Pr9hLSjKJe6If5YHAA7OBoDzgz65v7WUaD5zShhBNM5vcCdpiP7009%2BRc077x18QYvWL1wWw4pKkHLpVV98mGfL33ftd6kUdhCG%2BHKVXqJ9i50yfZgbLpo5WBxn7ynVZiXjH4A%2FdFqdQh40eaTcOZYyqtXPDW4vBJS5qWW2qSLeIwrE%2BM1DAMShctfpEihoJXibz4lfDUJvyHcNTz9bLbwO86d4G51PbNee4b%2FZR6nDf7nHjsLE9RBsez8c2fjq86ezae5IdSjATXwbSsMbABLpPMFPf9cTj6wzqsPzBi2R2XPjMTH8buhy4AK%2B34r5V1pABSdV0xaePwJURrND%2FIEAAA%3D"})]})}function u(t={}){const{wrapper:n}={...(0,i.R)(),...t.components};return n?(0,o.jsx)(n,{...t,children:(0,o.jsx)(p,{...t})}):p(t)}},3650:(t,n,e)=>{e.d(n,{A:()=>s});var o=e(6540),i=e(4848);function s(t){let{id:n,url:e}=t;const s=(0,o.useRef)(null);return(0,o.useEffect)((()=>{let t=null;document.getElementById("magic-iframe-"+n)?t=document.getElementById("magic-iframe-"+n):(t=document.createElement("iframe"),t.src=e,t.height="1050px",t.width="100%",t.scrolling="no",t.id="magic-iframe-"+n,document.body.appendChild(t));const o=s.current.getBoundingClientRect();return t.style.position="absolute",t.style.left=`${o.left+window.scrollX}px`,t.style.top=`${o.top+window.scrollY}px`,t.style.width=`${o.width}px`,t.style.height=`${o.height}px`,t.style.display="block",()=>{const t=document.getElementById("magic-iframe-"+n);t&&(t.style.left="-10000px",t.style.top="-10000px",t.style.width="0px",t.style.height="0px",t.style.display="none")}}),[]),(0,i.jsx)("div",{ref:s,style:{width:"100%",height:"1050px"}})}},8453:(t,n,e)=>{e.d(n,{R:()=>a,x:()=>r});var o=e(6540);const i={},s=o.createContext(i);function a(t){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function r(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:a(t.components),o.createElement(s.Provider,{value:n},t.children)}}}]);