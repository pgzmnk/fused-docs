<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-basics/tutorials/duckdb/Duckdb" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">DuckDB | Fused</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://fused-magic.s3.us-west-2.amazonaws.com/docs_assets/ecosystem_diagram.png"><meta data-rh="true" name="twitter:image" content="https://fused-magic.s3.us-west-2.amazonaws.com/docs_assets/ecosystem_diagram.png"><meta data-rh="true" property="og:url" content="https://fusedio.github.io/fused-docs/basics/tutorials/duckdb/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DuckDB | Fused"><meta data-rh="true" name="description" content="Tutorial on how call UDFs asynchronously with Fused."><meta data-rh="true" property="og:description" content="Tutorial on how call UDFs asynchronously with Fused."><link data-rh="true" rel="icon" href="/fused-docs/img/favicon.png"><link data-rh="true" rel="canonical" href="https://fusedio.github.io/fused-docs/basics/tutorials/duckdb/"><link data-rh="true" rel="alternate" href="https://fusedio.github.io/fused-docs/basics/tutorials/duckdb/" hreflang="en"><link data-rh="true" rel="alternate" href="https://fusedio.github.io/fused-docs/basics/tutorials/duckdb/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://JNTLW5AVDA-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/fused-docs/blog/rss.xml" title="Fused RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/fused-docs/blog/atom.xml" title="Fused Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Fused" href="/fused-docs/opensearch.xml"><link rel="stylesheet" href="/fused-docs/assets/css/styles.dfc287fd.css">
<script src="/fused-docs/assets/js/runtime~main.67cde9ef.js" defer="defer"></script>
<script src="/fused-docs/assets/js/main.fd674a8e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#991199;color:#ffffff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">⭐ If you like Fused, star the UDF <a target="_blank" rel="noopener noreferrer" href="https://github.com/fusedio/udfs/">GitHub</a> repo! ⭐</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fused-docs/"><div class="navbar__logo"><img src="/fused-docs/img/logo-black-bg-transparent.svg" alt="Fused Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/fused-docs/img/logo-black-bg-transparent.svg" alt="Fused Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Fused</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fused-docs/">Docs</a><a class="navbar__item navbar__link" href="/fused-docs/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/fusedio/udfs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/fused-docs/">Basics</a><button aria-label="Collapse sidebar category &#x27;Basics&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/quickstart/">Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/core-concepts/">Core Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/fused-docs/basics/in/">Get data in</a><button aria-label="Expand sidebar category &#x27;Get data in&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/fused-docs/basics/transform/">Transform data</a><button aria-label="Collapse sidebar category &#x27;Transform data&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/fused-docs/basics/transform/join/point-with-line/">Join operations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/transform/join/point-with-line/">🛠️ Point with line</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/transform/join/point-with-polygon/">🛠️ Point with polygon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/transform/join/polygon-with-polygon/">🛠️ Polygon with polygon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/transform/join/raster-with-point/">🛠️ Raster with point</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/transform/join/raster-with-polygon/">Raster with polygon (Zonal stats)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/fused-docs/basics/transform/raster/band-algebra/">Raster operations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/fused-docs/basics/transform/vector/buffer/">Vector operations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/fused-docs/basics/transform/h3/h3-to-raster/">H3 operations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/fused-docs/basics/transform/advanced/isochrone/">Advanced operations</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/fused-docs/basics/out/">Get data out</a><button aria-label="Expand sidebar category &#x27;Get data out&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/fused-docs/basics/tutorials/">Tutorials</a><button aria-label="Collapse sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/async/">Call UDFs async</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fused-docs/basics/tutorials/duckdb/">DuckDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/huggingface/">HuggingFace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/ingest/">Ingest</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/load/">Load</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/login/">Login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/noaa/">Create gif</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/nyc-taxy-od/">NYC Taxi OD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/overture/">Overture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/seasfire/">Create Tiles async</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/valhalla/">Routing with Valhalla</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/tutorials/zonalstats/">Forest Zonal Stats</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/fused-docs/basics/usecases/fcc-broadband/">Use cases</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/utilities/">Utilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fused-docs/basics/faq/">FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fused-docs/python-sdk/">Python SDK</a><button aria-label="Expand sidebar category &#x27;Python SDK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fused-docs/workbench/">Workbench</a><button aria-label="Expand sidebar category &#x27;Workbench&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fused-docs/contribute/">Contribute to Fused 🍪</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/fused-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/fused-docs/"><span itemprop="name">Basics</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/fused-docs/basics/tutorials/"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">DuckDB</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="link-buttons" style="text-align:right"><br><a href="https://githubtocolab.com/fusedio/fused-docs/blob/main/docs/basics/tutorials/duckdb.ipynb" target="_blank" rel="noopener noreferrer"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab"></a> <a href="https://github.com/fusedio/fused-docs/blob/main/docs/basics/tutorials/duckdb.ipynb" target="_blank" rel="noopener noreferrer"><img src="https://badgen.net/static/GitHub/Open/blue?icon=github" alt="Open in GitHub"></a></div>
<h1>DuckDB</h1>
<p>The combination of Fused serverless operations and DuckDB offers blazing fast data
processing. Fused has long embraced Python for its serverless User Defined Functions
(UDFs). Now, with the help of DuckDB, Fused enables developers to leverage the ease and
familiarity of SQL in these functions as well — without compromising on performance and
parallelism.</p>
<p>This notebook is support material for the blog post
<a href="https://medium.com/@fused/duckdb-fused-fly-beyond-the-serverless-horizon-886d892834aa" target="_blank" rel="noopener noreferrer">DuckDB + Fused: Fly beyond the serverless horizon</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-run-duckdb-in-a-fused-udf">1. Run DuckDB in a Fused UDF<a href="#1-run-duckdb-in-a-fused-udf" class="hash-link" aria-label="Direct link to 1. Run DuckDB in a Fused UDF" title="Direct link to 1. Run DuckDB in a Fused UDF">​</a></h2>
<p>As an example of running DuckDB within a Fused UDF, take the case of loading a
geospatial Parquet dataset. The &quot;DuckDB H3&quot; sample UDF runs an SQL query with DuckDB on
the NYC Taxi Trip Record
<a href="https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page" target="_blank" rel="noopener noreferrer">Dataset</a>. It uses the
<a href="https://docs.fused.io/basics/core-concepts/#the-bbox-object" target="_blank" rel="noopener noreferrer">bbox</a> argument to
spatially filter the dataset and automatically parallelize the operation.</p>
<p>To try this example, you can run the cell below. You can find the code of the UDF in the
Fused public UDF
<a href="https://github.com/fusedio/udfs/tree/main/public/DuckDB_H3_Example_Tile" target="_blank" rel="noopener noreferrer">repo</a>.</p>
<p>Alternatively, you can import the &quot;DuckDB H3 Example Tile&quot; UDF into your Fused Workbench
environment.</p>
<p>This pattern gives DuckDB easy parallel operations. Fused spatially filters the dataset
via the bbox parameter, runs the operation for each encompassing tile, and stitches the
results together. Because Fused breaks down operations to only a fraction of the
dataset, it&#x27;s easy to transition between SQL and Python.</p>
<img src="https://fused-magic.s3.us-west-2.amazonaws.com/docs_assets/nyc.png" alt="overture" width="600">
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># !pip install fused &quot;duckdb&gt;=0.10.1&quot; -q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> fused</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">udf </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> fused</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://github.com/fusedio/udfs/tree/main/public/DuckDB_H3_Example_Tile&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gdf </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> fused</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">udf</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">udf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">2412</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">3078</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token number" style="color:rgb(247, 140, 108)">13</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> engine</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;local&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gdf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">head</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th style="text-align:right"></th><th style="text-align:left">cell_id</th><th style="text-align:right">cell_lat</th><th style="text-align:right">cell_lng</th><th style="text-align:right">cnt</th><th style="text-align:left">geometry</th><th style="text-align:right">fused_index</th></tr></thead><tbody><tr><td style="text-align:right">0</td><td style="text-align:left">8b2a100d692cfff</td><td style="text-align:right">40.7691</td><td style="text-align:right">-73.9611</td><td style="text-align:right">6219</td><td style="text-align:left">POLYGON ((-73.96110 40.76935, -73.96140 40.769...</td><td style="text-align:right">0</td></tr><tr><td style="text-align:right">1</td><td style="text-align:left">8b2a100d6796fff</td><td style="text-align:right">40.7586</td><td style="text-align:right">-73.9858</td><td style="text-align:right">6132</td><td style="text-align:left">POLYGON ((-73.98577 40.75886, -73.98607 40.758...</td><td style="text-align:right">1</td></tr><tr><td style="text-align:right">2</td><td style="text-align:left">8b2a100d2922fff</td><td style="text-align:right">40.7509</td><td style="text-align:right">-73.9766</td><td style="text-align:right">2324</td><td style="text-align:left">POLYGON ((-73.97660 40.75118, -73.97691 40.751...</td><td style="text-align:right">2</td></tr><tr><td style="text-align:right">3</td><td style="text-align:left">8b2a100d6754fff</td><td style="text-align:right">40.7562</td><td style="text-align:right">-73.9786</td><td style="text-align:right">2174</td><td style="text-align:left">POLYGON ((-73.97864 40.75641, -73.97894 40.756...</td><td style="text-align:right">3</td></tr><tr><td style="text-align:right">4</td><td style="text-align:left">8b2a100d2d95fff</td><td style="text-align:right">40.7527</td><td style="text-align:right">-73.9932</td><td style="text-align:right">4826</td><td style="text-align:left">POLYGON ((-73.99319 40.75299, -73.99349 40.752...</td><td style="text-align:right">4</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-call-fused-udfs-from-duckdb">2. Call Fused UDFs from DuckDB<a href="#2-call-fused-udfs-from-duckdb" class="hash-link" aria-label="Direct link to 2. Call Fused UDFs from DuckDB" title="Direct link to 2. Call Fused UDFs from DuckDB">​</a></h2>
<p>Any database that supports querying data via HTTP can call and load data from Fused UDF
endpoints using common formats like Parquet or CSV. This means that DuckDB can dispatch
operations to Fused that otherwise would be too complex or impossible to express with
SQL, or would be unsupported in the local runtime.</p>
<p>As an example of calling a Fused endpoint from within DuckDB, take an operation to
vectorize a raster dataset. This might be necessary to determine the bounds of areas
with pixel value within a certain threshold range in an Earth observation image - such
as a Digital Elevation Model. SQL is not geared to support raster operations, but these
are easy to do in Python.</p>
<img src="https://fused-magic.s3.us-west-2.amazonaws.com/docs_assets/gifs/sql.gif" alt="overture" width="600">
<p>In this example, a Fused UDF returns a table where each record is a polygon generated
from the contour of a raster provided by the
<a href="https://spacedata.copernicus.eu/collections/copernicus-digital-elevation-model" target="_blank" rel="noopener noreferrer">Copernicus Digital Elevation Model</a>
as a <a href="https://www.cogeo.org/" target="_blank" rel="noopener noreferrer">Cloud Optimized GeoTIFF</a>. DuckDB can easily trigger a UDF
and load its output with this simple query, which specifies that the UDF endpoint
returns a Parquet file.</p>
<p>This SQL query uses DuckDB&#x27;s
<a href="https://duckdb.org/docs/data/parquet/overview.html" target="_blank" rel="noopener noreferrer">read_parquet</a> function to call an
endpoint of a UDF instance of the &quot;DEM Raster to Vector&quot; UDF.</p>
<p>You can find the code of the UDF in the Fused public UDF
<a href="https://github.com/fusedio/udfs/tree/main/public/DEM_Raster_to_Vector_Example" target="_blank" rel="noopener noreferrer">repo</a>.</p>
<p>To try this example, simply run the following SQL query on the cell below or in a
<a href="https://shell.duckdb.org/#queries=v0,SELECT-wkt%2C-area%0AFROM-read_csv(&#x27;https%3A%2F%2Fwww.fused.io%2Fserver%2Fv1%2Frealtime%20shared%2F&#x27;-%7C%7C%0A&#x27;1e35c9b9cadf900265443073b0bd99072f859b8beddb72a45e701fb5bcde807d&#x27;-%7C%7C%0A&#x27;%2Frun%2Ffile%3Fdtype_out_vector%3Dcsv&#x27;-%7C%7C%0A&#x27;%26min_elevation%3D500&#x27;)%0ALIMIT-10~" target="_blank" rel="noopener noreferrer">DuckDB shell</a>.
Change the <code>min_elevation</code> parameter to run the UDF for parts of California at different
elevations. (Note: for DuckDB WASM, the file will be requested as CSV.)</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">import</span><span class="token plain"> duckdb</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">con </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> duckdb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">con</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token triple-quoted-string string" style="color:rgb(173, 219, 103)">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token triple-quoted-string string" style="color:rgb(173, 219, 103)">    SELECT </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token triple-quoted-string string" style="color:rgb(173, 219, 103)">        wkt, </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token triple-quoted-string string" style="color:rgb(173, 219, 103)">        ROUND(area,1) AS area</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token triple-quoted-string string" style="color:rgb(173, 219, 103)">    FROM read_parquet(&#x27;https://www.fused.io/server/v1/realtime-shared/1e35c9b9cadf900265443073b0bd99072f859b8beddb72a45e701fb5bcde807d/run/file?min_elevation=500&amp;dtype_out_vector=parquet&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token triple-quoted-string string" style="color:rgb(173, 219, 103)">    LIMIT 5</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token triple-quoted-string string" style="color:rgb(173, 219, 103)">&quot;&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="background-color:var(--ifm-background-surface-color);margin-bottom:var(--ifm-leading);border-radius:var(--ifm-global-radius);box-shadow:var(--ifm-global-shadow-lw);overflow:hidden;padding:10px;font:var(--ifm-code-font-size) / var(--ifm-pre-line-height) var(--ifm-font-family-monospace)"><span style="color:var(--ifm-color-primary)">Out: </span><pre style="margin:0px;background-color:inherit"><p style="margin-bottom:0px">┌────────────────────────────────────────────────────────────────────────────────────────────────────────┬─────────────┐</p><p style="margin-bottom:0px">│                                                  wkt                                                   │    area     │</p><p style="margin-bottom:0px">│                                                varchar                                                 │   double    │</p><p style="margin-bottom:0px">├────────────────────────────────────────────────────────────────────────────────────────────────────────┼─────────────┤</p><p style="margin-bottom:0px">│ POLYGON ((-124.1827015175656186 42.2400766748579528, -124.1827015175656186 42.1992724119226850, -124…  │  15409410.3 │</p><p style="margin-bottom:0px">│ POLYGON ((-124.3052742356768618 42.2808809377932349, -124.1827015175656186 42.2808809377932207, -124…  │ 138751711.8 │</p><p style="margin-bottom:0px">│ POLYGON ((-124.3869893810843479 42.1176638860521493, -124.3869893810843479 42.0768596231168956, -124…  │  15447026.2 │</p><p style="margin-bottom:0px">│ POLYGON ((-124.2235590902693616 42.1176638860521564, -124.2235590902693616 42.0360553601816278, -124…  │  30891651.3 │</p><p style="margin-bottom:0px">│ POLYGON ((-124.1827015175656186 41.7912297825700350, -124.1827015175656186 41.7504255196347742, -124…  │  15518755.9 │</p><p style="margin-bottom:0px">└────────────────────────────────────────────────────────────────────────────────────────────────────────┴─────────────┘</p></pre></div>
<p>This pattern enables DuckDB to address use cases and data formats that it doesn&#x27;t
natively support or would otherwise see high data transfer cost, such as raster
operations, API calls, and control flow logic.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-integrate-duckdb-in-applications-using-fused">3. Integrate DuckDB in applications using Fused<a href="#3-integrate-duckdb-in-applications-using-fused" class="hash-link" aria-label="Direct link to 3. Integrate DuckDB in applications using Fused" title="Direct link to 3. Integrate DuckDB in applications using Fused">​</a></h2>
<p>Fused is the glue layer between DuckDB and apps. This enables seamless integrations that
trigger Fused UDFs and load their results with simple parameterized HTTP calls.</p>
<p>DuckDB is an embedded database engine and doesn&#x27;t have built-in capability to share
results other than writing out files. As a corollary of the preceding example, it&#x27;s
possible to query and transform data with DuckDB and seamlessly integrate the results of
queries into any workflow or app.</p>
<p>As an example, take the case of loading the output of a DuckDB query into Google Sheets.
Sheets can easily structure the Fused UDF endpoint to pass parameters defined in
specific cells as URL query parameters. In this example, the
<a href="https://support.google.com/docs/answer/3093335?hl=en" target="_blank" rel="noopener noreferrer">importData</a> command calls the
endpoint for the UDF above and loads its output data in CSV format. It constructs the
endpoint string by concatenating a base URL with the <code>B2</code>, <code>B3</code>, and <code>B4</code> cell values as
query parameters.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">importData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CONCATENATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;https://www.fused.io/server/v1/realtime-shared/aba7b238d9445d576e15b2d6b780dc353bfdee55f02a285a85a3917b72835600/run/file?dtype_out_vector=csv&amp;resolution=&quot;</span><span class="token plain">, B2, </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;&amp;min_count=&quot;</span><span class="token plain">, B3, </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;&amp;head=&quot;</span><span class="token plain">, B4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<img src="https://fused-magic.s3.us-west-2.amazonaws.com/docs_assets/gifs/sheets.gif" alt="overture" width="600">
<p>To try this example simply make a copy of
<a href="https://docs.google.com/spreadsheets/d/1iufyjEct5bQjYAI8v1Mb5e29yG8ukzH4X8MD6oP1xLQ/edit?usp=sharing" target="_blank" rel="noopener noreferrer">this</a>
Google Sheets spreadsheet (File &gt; Make a copy) and click, and modify the parameters in
<code>B2:4</code> to trigger the Fused UDF endpoint and load data.</p>
<p>You can learn more about the Google Sheets integration in the
<a href="/fused-docs/basics/out/googlesheets/">documentation</a>.</p>
<p>This pattern brings the power of the DuckDB analytical engine into non-analytical and
no-code software like Google Sheets, Retool, and beyond - without the need to build
bespoke integrations with closed-source systems. With this, a Python developer can
abstract away the UDF and deliver data to end users. This removes the need to even
install DuckDB.</p>
<pre tabindex="0" class="codeBlockStandalone_MEMb thin-scrollbar language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><code class="codeBlockLines_e6Vv"></code></pre></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/fused-docs/basics/tutorials/async/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Call UDFs async</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fused-docs/basics/tutorials/huggingface/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">HuggingFace</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-run-duckdb-in-a-fused-udf" class="table-of-contents__link toc-highlight">1. Run DuckDB in a Fused UDF</a></li><li><a href="#2-call-fused-udfs-from-duckdb" class="table-of-contents__link toc-highlight">2. Call Fused UDFs from DuckDB</a></li><li><a href="#3-integrate-duckdb-in-applications-using-fused" class="table-of-contents__link toc-highlight">3. Integrate DuckDB in applications using Fused</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fused-docs/">Overview</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/fusedio/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.com/invite/BxS5wMzdRk" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.fused.io/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/fusedio/udfs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Fused, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>